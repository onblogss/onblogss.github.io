---
layout: post
title: 删除Github仓库提交历史变成新仓库
date: 2021-12-26 02:02:00
author: 薛师兄
tags:
- Github
---

写了个脚本，可以帮我们把 Github 仓库的 master 分支的提交历史删除，并且以新的 username 和 email 提交全部代码，最终变为只有一次 commit 的 Github 仓库。适合帮我们去除一些隐私信息！

首先我们需要本地与远程Github进行关联，正常执行 git push 命令。

然后我们新建本地全局的 Git 提交人信息：

```shell
git config --global user.name "Jack"
git config --global user.email "jack@gmail.com"
```

查看刚刚的修改有没有生效：

```shell
git config --list
```

接下来我们新建一个 update.sh 文本文件，并复制以下代码：

```shell
#!/bin/bash
date
for line in $(cat $1)
do
    echo $line
    git clone https://github.com/${2}/${line}.git && cd ${line} && git checkout --orphan latest_branch && git add -A && git commit -am "commit message" && git branch -D master && git branch -m master && git push -f origin master && cd .. && rm -rf ./${line}
    echo -e "\n"
done
date
```

> 这里使用的是 http 下载方式，你也可以使用 ssh 下载：`git@github.com:${2}/${line}.git`

如果你的仓库特别多，顺序执行比较慢的话，也可以并行处理每个仓库。代码如下：

```shell
#!/bin/bash
date
for line in $(cat $1)
do
{
    git clone https://github.com/${2}/${line}.git && cd ${line} && git checkout --orphan latest_branch && git add -A && git commit -am "commit message" && git branch -D master && git branch -m master && git push -f origin master && cd .. && rm -rf ./${line}
    echo $line
    echo -e "\n"
} &
done
wait
date
```

然后新建 list.txt 文本文件，将你的仓库名称逐行进行复制粘贴，例如：

```txt
Spring
Log4j
Junit
```

最后，我们赋予脚本执行权限，并执行该脚本：

```shell
# 赋予执行权限
chmod +x ./update.sh

# 假设github用户名为jack，并且指定list.txt的相对路径
./update.sh ./list.txt jack
```

执行结束后，访问Github，查看仓库 commit 记录去吧！
